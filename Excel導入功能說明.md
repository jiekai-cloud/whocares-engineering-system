# Excel 施工日誌導入功能說明

## 功能概述

派工紀錄管理系統現在支持通過 Excel 檔案批量導入施工日誌。系統會自動解析 Excel 表單並將施工人員派工資料匯入到對應的專案中。

## Excel 表單格式要求

### 必要欄位

您的 Excel 表單必須包含以下欄位（欄位名稱必須完全一致）：

1. **案件編號及名稱** - 用於匹配系統中的專案
2. **施工日期** - 派工日期（支援格式：YYYY-MM-DD 或 YYYY/MM/DD）
3. **施工人員** - 施工人員名稱（多人用逗號、頓號或空格分隔）

### 選用欄位

以下欄位為選用，如果存在會被讀取：

- **施工進度說明** - 工作描述
- **施工項目** - 工作項目
- **申請日期** - 如果沒有施工日期，會使用此欄位作為派工日期

### 其他欄位

表單中的其他欄位（如表單編號、申請人、部門等）不會影響導入功能，系統會自動忽略。

## 使用步驟

### 1. 準備 Excel 檔案

確保您的 Excel 檔案：
- 格式為 `.xlsx` 或 `.xls`
- 第一行是欄位標題
- 包含必要的欄位名稱

### 2. 上傳檔案

1. 進入「派工紀錄」功能
2. 點擊「Excel 匯入」標籤
3. 點擊「選擇 Excel 檔案」按鈕，或直接拖放檔案到上傳區域
4. 選擇您的施工日誌 Excel 檔案

### 3. 確認並修正

系統會自動解析 Excel 內容並顯示在右側預覽區：

- **綠色標籤** - 表示系統成功匹配到對應的專案
- **紅色標籤** - 表示系統無法自動匹配專案，需要手動選擇

對於紅色標籤的項目：
1. 點擊下拉選單
2. 手動選擇正確的專案
3. 標籤會變為綠色

### 4. 調整派工資訊

在匯入前，您可以調整每筆派工記錄的：
- 單日薪資（系統會自動帶入該員工的預設日薪）
- 派工天數（預設為 1 天）

### 5. 批量匯入

確認所有資料正確後：
1. 點擊右上角的「匯入紀錄」按鈕
2. 系統會將所有綠色標籤的記錄匯入到對應專案
3. 紅色標籤的記錄需要先修正後才能匯入

## 範例 Excel 格式

```
| # | 表單編號 | 申請人 | 部門 | 申請日期 | 施工日期 | 案件編號及名稱 | 施工進度說明 | 施工項目 | 施工人員 | ... |
|---|----------|--------|------|----------|----------|----------------|--------------|----------|----------|-----|
| 1 | F001 | 張三 | 工程部 | 2024-01-15 | 2024-01-16 | PRJ001-外牆防水 | 外牆防水處理第一階段 | 防水施工 | 王小明,李大華 | ... |
| 2 | F002 | 李四 | 工程部 | 2024-01-15 | 2024-01-17 | PRJ002-屋頂維修 | 屋頂漏水修補 | 屋頂防水 | 陳志偉 | ... |
```

## 自動匹配邏輯

### 專案匹配

系統會嘗試將「案件編號及名稱」欄位與系統中的專案進行匹配：
- 完全匹配專案名稱
- 部分匹配專案名稱（包含關係）
- 匹配專案 ID

### 人員匹配

系統會嘗試匹配施工人員：
- 完全匹配員工姓名
- 匹配員工別名/暱稱
- 自動帶入該員工的預設日薪

如果無法匹配到系統中的員工，系統會：
- 將其標記為外部人員（EXTERNAL）
- 使用預設日薪 2500 元

## 批量處理

系統支援一次處理多筆施工記錄：
- 如果一筆施工記錄包含多個施工人員（用逗號分隔），系統會自動拆分為多筆派工記錄
- 每個工人會佔用一筆派工記錄

## 注意事項

⚠️ **重要提醒**：
1. Excel 欄位名稱必須與要求完全一致（包括中文字符）
2. 日期格式建議使用 YYYY-MM-DD 或 YYYY/MM/DD
3. 施工人員之間建議用逗號（,）分隔
4. 無法自動匹配的專案必須手動選擇，否則無法匯入
5. 匯入後無法批量撤銷，請仔細確認後再匯入

## 常見問題

### Q: 為什麼我的專案顯示紅色標籤？

**A**: 表示系統無法自動匹配到對應的專案。可能原因：
- Excel 中的案件名稱與系統中的專案名稱不一致
- 專案尚未在系統中建立
- 建議手動從下拉選單中選擇正確的專案

### Q: 可以一次導入多少筆記錄？

**A**: 理論上沒有數量限制，但建議：
- 單次導入不超過 100 筆記錄
- 大量資料可以分批導入

### Q: 導入的記錄可以刪除嗎？

**A**: 可以。匯入後的記錄會出現在下方的「累積派工紀錄明細」表格中，您可以逐筆刪除。

### Q: 施工人員名稱必須完全一致嗎？

**A**: 是的。建議：
- 確保 Excel 中的人員名稱與系統中的員工名稱一致
- 或在員工資料中設定別名/暱稱以支援不同的名稱格式

## 技術支援

如遇到導入問題，請檢查：
1. Excel 檔案格式是否正確（.xlsx 或 .xls）
2. 必要欄位是否都存在
3. 瀏覽器控制台是否有錯誤訊息

如問題持續，請聯繫系統管理員並提供：
- Excel 檔案樣本
- 錯誤訊息截圖
- 操作步驟描述
